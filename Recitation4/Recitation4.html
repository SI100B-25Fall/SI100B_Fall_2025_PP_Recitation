<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>SI100B_Fall_2025_Recitation_4</title>
  <link rel="shortcut icon" href="./favicon.ico" />
  <link rel="stylesheet" href="./dist/reset.css" />
  <link rel="stylesheet" href="./dist/reveal.css" />
  <link rel="stylesheet" href="./dist/theme/simple.css" id="theme" />
  <link rel="stylesheet" href="./css/highlight/github.css" />

  <link rel="stylesheet" href="./_assets/assets/custom.css" />
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section data-markdown data-separator="<!--s-->" data-separator-vertical="<!--v-->">
        <textarea data-template>
            
<p style="font-size: 16px; color: #999; margin:5px; position: absolute;"><a href="..">Homepage</a> | <a href="?print-pdf">Printable Version</a></p>
<div style="display: flex; justify-content: center; align-items: center; height: 700px;">
  <div style="text-align: center; padding: 40px; background-color: white; border: 2px solid rgb(0, 63, 163); border-radius: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.1);">
    <h1 style="font-size: 48px; font-weight: bold; margin-bottom: 20px; color: #333;">SI100B Fall 2025 Recitation 4</h1>
    <p style="font-size: 24px; color: #666;">L7 & L8</p>
    <p style="font-size: 16px; color: #999; margin-top: 20px; margin-bottom:5px">SI100B 2025 Staff | 2025-10-17</p>
  </div>
</div>

<!--s-->


<div class="middle center"><div style="width: 100%">

# Functions as Objects

</div></div>

<!--v-->
## Functions as Objects
- 回顾：“Python 中，函数是一等公民”

- 函数可以像其他数据类型一样被传递、赋值和使用

- 示例：灵活折扣系统
    - 定义主函数`apply_discount(price, discount_strategy)`
    - `discount_strategy`是一个函数，计算折扣金额

<!--v-->
### Example: Discount Strategy System
```py
def apply_discount(price, discount_strategy):
    discount = discount_strategy(price)
    final_price = price - discount
    return final_price

# 定义一些折扣策略函数
def fixed_discount(price):
    """固定折扣 - 减 10 元"""
    return 10

def bulk_discount(price):
    """批量折扣 - 满 100 打 8 折，否则 9 折"""
    if price > 100:
        return price * 0.2  # 20% 折扣
    return price * 0.1     # 10% 折扣
```
- Lambda function 的形式？

<!--v-->
### 使用示例

```py
original_price = 150.0

# 固定折扣
apply_discount(original_price, fixed_discount) # 进行的计算：150.0 - 10

# 批量折扣
apply_discount(original_price, bulk_discount) # 150.0 - 150.0 * 0.2

# 也可以直接使用 lambda 函数……
apply_discount(original_price, lambda p: p * 0.15)  # 15% 折扣
```

<!--s-->
<div class="middle center"><div style="width: 100%">

# Tuple

</div></div>
<!--v-->
## Tuples（元组）
- 一种新的复合数据类型

- 不可变（immutable）

- 用圆括号`()`表示

- 支持索引、切片、合并、长度、最大/最小值等操作


**Tuples操作示例**
```python
tuple_empty = ()      # 空元组
tuple_short = (2,)    # 单元素元组需加逗号
hello_tuple = (2, "stu", 3)
hello_tuple[0]   # 2
hello_tuple[1:3] # ("stu", 3)
```

<!--v-->

## 接受任意数量的参数

一些内置函数的参数数量不固定，可接受任意数量的参数，如 `min()`, `max()`, `mean()`。

自己写函数时，可在某个参数前加 `*` 符号来实现相同功能：

```py
def mean(*args): tot = 0
    print(type(args)) # tuple
    print(args) # tuple
    for a in args:
        tot += a
return tot / len(args)
mean(1, 2, 3, 4, 5, 6) # args: tuple (1, 2, 3, 4, 5, 6)
```

上例中，`args` 绑定到所提供的若干值组成的**元组**。

<!--s-->
<div class="middle center"><div style="width: 100%">

# 拓展：Tuples

</div></div>
<!--v-->
## Properties of Tuples

- Tuple is about immutability（不可变）

- It encapsulates a _linear_ order, like a _struct_, but without field names.
    - You don't want to accidentally modify its structure!
    - e.g. A list of points in $\mathbb {R}^2$: `[(0.2, 0.3), (1.1, 1.2), ...]`

- Is _hashable_ (if its elements are hashable), therefore can be used as keys in dictionary (`dict`).

<!--v-->
## Properties of Tuples
- Singletons（可作为单例）
  ```py
  >>> 1 == (1) != (1,)
  True
  ```
- Constructors（可直接构造对象）
  `tuple()` accepts iterables

- Packing and Unpacking
  ```py
  temperature, humidity = get_weather()
  a, b, c = c, a, b
  ```
  
<!--v-->
Linear Operations...
- Linear indexing, Slicing
  ```py
  ('a', 'b', 'c', 'd')[3] == 'd'
  (0, 1, 2, 3, 4, 5)[1:3] == (1, 2)
  (0, 1, 2, 3)[::-1] == (3, 2, 1, 0)
  ```
- Concatenation, Repeating
  ```py
  (1, 2, 3, 4) + (10, 11) == (1, 2, 3, 4, 10, 11)
  (1, 2) * 3 == (1, 2, 1, 2, 1, 2)
  ```
- Sorting
  ```py
  sorted_tuple = tuple(sorted(original_tuple))
  ```

<!--s-->

<div class="middle center"><div style="width: 100%">

# List

</div></div>

<!--v-->
## List (列表)
- 可变（mutable）序列
- 用方括号`[]`表示
- 可包含任意类型元素
- 支持索引、切片、合并、迭代等操作

```python
empty_list = []
hello_list = [2, "a", 4, [1, 2]]
hello_list[0]      # 2
hello_list[3]      # [1, 2]
[1, 2] + [3, 4]    # [1, 2, 3, 4]
```
<!--v-->
## 常用的 List 的方法
- `append(element)`：在末尾添加元素；无返回值 (`None`)

- `sort()`：原地对元素进行排序；无返回值 (`None`)
    - 默认正序；加上可选参数 `reverse=True`为倒序
    - 可指定要参照哪个关键字进行排序；详情查阅 Python 手册

- `reverse()`：原地反向排列元素；无返回值 (`None`)

- `sorted(list)`：返回新排序的列表；**不修改原列表**

**“原地”/“就地”**：对对象本身进行修改
<!--v-->
## Lists与函数
可传递列表给函数，函数内可修改原列表（副作用）
示例：平方列表中所有元素
```python
def square_list(L):
    for i in range(len(L)):
        L[i] = L[i] ** 2
```
<!--v-->
## 字符串与列表互转
字符串转列表：
- `list(s)`：每个字符作为元素
- `s.split(char)`：以字符 `char` 作为分隔符，进行分割

列表转字符串：
- `'_'.join(L)`：用指定字符连接
    - `''.join(L)`：将列表中的所有元素连成一整个字符串


<!--s-->
<div class="middle center"><div style="width: 100%">

# Aliasing & Cloning (Copying)

</div></div>

<!--v-->
## 回顾：可变对象和不可变对象
- **可变 (Mutable) 对象**：如果要修改对象，可直接原地修改，不用重新创建；
  - 常见类型：列表 `list`，字典 `dict`，集合 `set` 等
  - 例：可直接添加、删除或更改列表的元素

- **不可变 (Immutable) 对象**: 对象一旦创建便不可更改；若要修改，只能重新创建一个新的
  - 常见类型：字符串 `string`，整型 `int`，元组 `tuple` 等
  - 例：“修改”一个整数，实际上创建了一个新的整型对象并删除了原先的；元组一旦创建，其内容无法修改

<!--v-->
## 为什么需要 Copy？
- 赋值语句只是为一个对象**另起**了一个名字（aliasing）

- 对于自身可变的对象，会使目标和对象同时改变
    - 许多情况下会导致意外修改

```py
l1 = [1, 2, 3]
l2 = l1
l2.append(4)
print(l2)  # [1, 2, 3, 4] modified
print(l1)  # [1, 2, 3, 4]
```

<!--v-->
### 回顾：函数传入可变对象
- 场景：函数可能对传入的参数进行修改
    - 若传入了可变对象，函数对参数进行的修改将直接影响其原始对象

```py
def foo(l2):
    print("Id of l2 before revised:", id(l2))
    l2.append(4)
    print("Id of l2 after revised:", id(l2)) # same
 
l1 = [1, 2, 3]
print("Id of l1:", id(l1))
foo(l1)
print(l1) # [1, 2, 3, 4]
```

<!--v-->
## 对一个列表进行 Copy
改变生成的副本不会影响原始对象

`l2 = l1[:]`，或 `import copy` 后 `l2 = copy.copy(l1)`
- 等价于：创建空列表 `l2` - 遍历 `l1`，将 `l1` 的每个元素依次 `append` 进 `l2`
```py[]
l1 = [4, 5, 6]
l2 = l1[:]
l2.append(7)
print(l2)  # [4, 5, 6, 7]
print(l1)  # [4, 5, 6]
```
<img src="images/Tutorial4_copy.png" width="60%" style="display: block; margin: 0 auto;">

<!--v-->
## 有嵌套的可变对象：避免 Shallow Copy 
- 上述 `l2 = l1[:]` 和 `l2 = copy.copy(l1)` 都属于浅拷贝（Shallow Copy）
- 浅拷贝 **仅拷贝嵌套的第一层** ，第二层或更深（例如其中的可变对象）不会被拷贝

<img src="images/Tutorial4_copy_nested.png" width="80%" style="display: block; margin: 0 auto;">

<!--v--> 
## 有嵌套的可变对象：Deep Copy
- 当嵌套结构中的元素可能是可变对象时，使用**深拷贝**
    - 确保每个嵌套层级的每个结构都被复制
<img src="images/Tutorial4_deep_copy.png" width="90%" style="display: block; margin: 0 auto;">

<!--v-->
## (Optional) 如果只拷贝 k 层呢? 
```py[]
def k_level_copy(obj, k):
    if k <= 0:
        return obj
    if isinstance(obj, list):
        new_list = []
        for item in obj:
            new_list.append(k_level_copy(item, k - 1))  
        return new_list
    elif isinstance(obj, dict):
        ...
    else:
        return obj  # Return the object if it's immutable
```

<!--v-->
## (Optional) 如果只拷贝嵌套的前 k 层呢?
```py
# Example usage
original = [1, [2, [3, [4 , 4]]]]
deepk_copied = k_level_copy(original, 3)

# Modify the deep copy
deepk_copied[1][1][0] = 'Changed'
deepk_copied[1][1][1][1] = 'Changed'
print(original) # [1, [2, [3, [4, 'Changed']]]]
print(deepk_copied) # [1, [2, ['Changed', [4, 'Changed']]]]
```
- `k_level_copy(original, 1)` 等价于 `copy.copy(original)` 
- `k_level_copy(original, 4)` 等价于 `copy.deepcopy(original)` 

<!--v-->
## 更多例子
```py
import copy
orig = ['Hi, I am ', list('Bob')]
alias = orig
shallow = orig.copy()
deep = copy.deepcopy(orig)
orig[0] = 'Hi, he is'
orig[1][0] = 'C'
print(orig, alias, shallow, deep, sep='\n')
```
What should be the output?

<!--v-->
## 更多例子
```text
['Hi, he is', ['C', 'o', 'b']]
['Hi, he is', ['C', 'o', 'b']]
['Hi, I am ', ['C', 'o', 'b']]
['Hi, I am ', ['B', 'o', 'b']]
```
<!--v-->
## Some cool list comprehension solutions
```py
def remove_all(l, val):
    return [x for x in l if x != val]
```
```py
def remove_dups(L1, L2):
    return [x for x in L1 if x not in L2]
```
<!--s-->

<div class="middle center"><div style="width: 100%">

# 拓展：Decorators

</div></div>

<!--v-->

> Anything in Python is an object.

```py
def nice():
    print('hello')
def apathetic():
    print('...')
```

```py
import random
logic = {0: nice, 1: apathetic, 2: nice}
logic[random.randint(0, 2)]()
```

```text
hello
```

<!--v-->

作为对象传递：

```py
def plus(x, y):
    return x + y
def div(x, y):
    return x / y
def perform(x, y, op):
    print(op(x, y))
    
perform(2, 3, div)  
perform(2, 10, lambda x, y: x**y) 
```
```text
0.6666666666666666
1024
```

<!--v-->

作为函数的返回值：
```py
def wrapper(rapper):
    def greet():
        print('This is rapper ' + rapper + '.')
    return greet

wrapper('Ken')()  

```
```text
This is rapper Ken.
```

<!--v-->
If a function takes a function as argument and returns a function, it can actually produce a modified version of the argument function. Python allows us to perform such modification with the notation `@`.

```py
# The decorator 
def triplet(f):
    def _inner(x):
        f(x)
        f(x)
        f(x)
    return _inner

def annihilator(f):
    def do_nothing(*args, **kwargs):
        pass
    return do_nothing
```
<!--v-->
```py
@triplet
def say(name):
    print('hello ' + name)
    
@annihilator
def say_goodbye(word):
    print(word)
```

```py
say('world')
print('----')
say_goodbye('I will miss you', time = 2)
```

```text
hello world
hello world
hello world
----
```

<!--v-->
An example from wiki.python.org:

```py
def __main__(func):

    if __name__ == "__main__":
        import sys, os
        args = sys.argv[:]
        args[0] = os.path.abspath(args[0])
        func(*args)
        
@__main__
def main(*args):
    print(f'main received {len(args)} arguments')
```

```bash
$ python main.py 1 2 3      
main received 4 arguments
```
<!--v-->

Some useful decorators, built-in or provided by modules...
- Call the function when program terminates: `@atexit.register`
- Checks if the values in a enum declaration is unique: `@enum.unique`
- Partial function that pre-specifies some parameters: `partial()`
  e.g. `lean_print = functools.partial(print, end = '', sep = '')`

More to be used in OOP...
- Generates `__init__` etc. (_class_ decorator!): `@dataclasses.dataclass`
- Declare static (global/within a class) functions: `@staticmethod`, `@classmethod`
- Getter method: `@property`


<!--s-->

<div style="display: flex; justify-content: center; align-items: center; height: 700px;   ">
  <div style="text-align: center; padding: 40px; background-color: white; border-radius: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.1);">
    <div style="display: inline-block; padding: 20px 40px; border-radius: 10 px; margin-bottom: 20px;">
      <h1 style="font-size: 48px; font-weight: bold; margin: 0; color: rgb(16, 33, 89)">Thanks for Listening</h1>
    </div>
    <p style="font-size: 24px; color: #666; margin: 0;">Any questions?</p>
  </div>
</div>
          </textarea>
      </section>
    </div>
  </div>

  <script src="./dist/reveal.js"></script>

  <script src="./mermaid/dist/mermaid.min.js"></script>

  <script src="./plugin/markdown/markdown.js"></script>
  <script src="./plugin/highlight/highlight.js"></script>
  <script src="./plugin/zoom/zoom.js"></script>
  <script src="./plugin/notes/notes.js"></script>
  <script src="./plugin/math/math.js"></script>
  <!-- Font awesome is required for the chalkboard plugin -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Custom controls plugin is used to for opening and closing annotation modes. -->
  <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/customcontrols/plugin.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/customcontrols/style.css">
  <!-- Chalkboard plugin -->
  <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/chalkboard/plugin.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/chalkboard/style.css">
  <script>
    function extend() {
      var target = {};
      for (var i = 0; i < arguments.length; i++) {
        var source = arguments[i];
        for (var key in source) {
          if (source.hasOwnProperty(key)) {
            target[key] = source[key];
          }
        }
      }
      return target;
    }

    // default options to init reveal.js
    var defaultOptions = {
      controls: true,
      progress: true,
      history: true,
      center: false,
      width: 1000,
      pdfSeparateFragments: false,
      transition: 'slide',
      transitionSpeed: 'fast',
      slideNumber: "c/t",
      highlight: {
        highlightOnLoad: false
      },
      plugins: [
        RevealMarkdown,
        RevealHighlight,
        RevealZoom,
        RevealNotes,
        RevealMath.KaTeX,
        RevealChalkboard,
        RevealCustomControls,
      ],
      customcontrols: {
        controls: [
          {
            icon: '<i class="fa fa-pen-square"></i>',
            title: 'Toggle chalkboard (B)',
            action: 'RevealChalkboard.toggleChalkboard();'
          },
          {
            icon: '<i class="fa fa-pen"></i>',
            title: 'Toggle notes canvas (C)',
            action: 'RevealChalkboard.toggleNotesCanvas();'
          }
        ]
      },
      chalkboard: {
        // add configuration here
      },
    };

    // options from URL query string
    var queryOptions = Reveal().getQueryHash() || {};

    var options = extend(defaultOptions, {"_":["./materials/Recitation4/Recitation4.md"],"static":"static/Recitation4","template":"./assets/reveal.html","preprocessor":"./assets/preproc.js","scripts":"assets/menu/menu.js,assets/inject.js"}, queryOptions);
  </script>

  <script src="./_assets/assets/menu/menu.js"></script>
  <script src="./_assets/assets/inject.js"></script>

  <script>
    Reveal.initialize(options);
    Reveal.addEventListener('ready', function (event) {
      const blocks = Reveal.getRevealElement().querySelectorAll('pre code:not(.mermaid)');
      const hlp = Reveal.getPlugin('highlight');
      blocks.forEach(hlp.highlightBlock);
    });
  </script>

  <script>
    const mermaidOptions = extend({ startOnLoad: false }, {});
    mermaid.startOnLoad = false;
    mermaid.initialize(mermaidOptions);
    const cb = function (event) {
      mermaid.init(mermaidOptions, '.stack.present > .present pre code.mermaid');
      mermaid.init(mermaidOptions, '.slides > .present:not(.stack) pre code.mermaid');
    }
    Reveal.addEventListener('ready', cb);
    Reveal.addEventListener('slidetransitionend', cb);
  </script>
</body>

</html>